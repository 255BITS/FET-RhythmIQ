<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RhythmIQ - Infinite AI Radio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <script src="https://unpkg.com/idiomorph@0.3.0/dist/idiomorph-ext.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body hx-ext="morph" class="bg-[#1a1b26] text-gray-100 font-sans" x-data="{
    isMuted: false,
    toggleMute() {
        this.isMuted = !this.isMuted; const audioPlayer = document.getElementById('audio-player'); if (audioPlayer) { audioPlayer.muted = this.isMuted; }
    },
    isPlaying: false,
    currentTime: 0,
    duration: 0,
    progress: 0,
    updateProgress() {
        this.currentTime = this.$refs.audioPlayer.currentTime;
        this.duration = this.$refs.audioPlayer.duration || 0;
        this.progress = (this.currentTime / this.duration) * 100;
    },
    seekSong(event) {
        const progressBar = event.currentTarget;
        const clickPosition = event.offsetX;
        const barWidth = progressBar.offsetWidth;
        const clickRatio = clickPosition / barWidth;
        const newTime = clickRatio * this.duration;
        this.$refs.audioPlayer.currentTime = newTime;
        this.updateProgress();
    }
}"
}">
  <audio id="audio-player" x-ref="audioPlayer" src="{{ current_song.audio_url }}" x-on:timeupdate="updateProgress()"></audio>
    <div class="max-w-4xl mx-auto p-6">
        <div class="retro-player-container">
            <div class="player-header">
                <div class="logo-container">
                    <span class="wave-icon">(((â€¢)))</span>
                    <h1 class="retro-title">RhythmIQ</h1>
                </div>
                <div class="volume-control">
                    <button x-on:click="$refs.audioPlayer.muted = !$refs.audioPlayer.muted" x-text="$refs.audioPlayer.muted ? 'ðŸ”‡' : 'ðŸ”Š'" class="volume-icon"></button>
                    <input 
                        type="range" 
                        min="0" max="1" 
                        step="0.01" 
                        x-on:input="$refs.audioPlayer.volume = $event.target.value; $event.target.style.setProperty('--volume-percent', ($event.target.value * 100) + '%')"
                        class="volume-slider">
                </div>

            </div>

            {% block content %}{% endblock %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
